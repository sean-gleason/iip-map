let map_id=iip_map_params.map_id,zoom=iip_map_params.map_zoom,lat=iip_map_params.map_center_lat,lng=iip_map_params.map_center_lng,mapDataEndpoint="/wp-json/iip-map/v1/maps/"+map_id,mapDataXHR=new XMLHttpRequest;mapDataXHR.open("GET",mapDataEndpoint),mapDataXHR.responseType="json",mapDataXHR.send(),mapDataXHR.onload=function(){let e=mapDataXHR.response;mapDataXHR.statusText;plotMarkers(e)};const markerSource=new ol.source.Vector;let markerStyle=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:.75,src:"/wp-content/plugins/iip-map/images/map-pin.png"})}),clusterSource=new ol.source.Cluster({distance:50,source:markerSource}),styleCache={};function clusterStyle(e){let t=e.get("features").length,n=styleCache[t];return n||(n=new ol.style.Style({image:new ol.style.Circle({radius:15,stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#0081FF"})}),text:new ol.style.Text({text:t.toString(),fill:new ol.style.Fill({color:"#fff"})})}),styleCache[t]=n),n}let baseLayer=new ol.layer.Tile({source:new ol.source.OSM}),clusterLayer=new ol.layer.Vector({source:clusterSource,style:clusterStyle}),markerLayer=new ol.layer.Vector({source:clusterSource,style:markerStyle}),mapCenter=new ol.View({center:ol.proj.fromLonLat([parseFloat(lng),parseFloat(lat)]),zoom:parseInt(zoom)}),map=new ol.Map({target:"map",controls:ol.control.defaults({attributionOptions:{collapsible:!0}}),layers:[baseLayer,clusterLayer],view:mapCenter});function plotMarkers(e){e.forEach(function(e){let t=[parseFloat(e.lng),parseFloat(e.lat)];null!==e.event_topic&&""!==e.event_topic?topicLine='<h3 class="iip-map-ol-popup-header">Topic: '+e.event_topic+"</h3>":topicLine="<div></div>",null!==e.event_duration&&""!==e.event_duration?durationLine="Estimated duration: "+e.event_duration+"</p>":durationLine="",null!==e.host_name&&""!==e.host_name?hostLine=e.host_name:hostLine="",null!==e.contact&&""!==e.contact?contactLine=e.contact:contactLine="",""!==hostLine&&""!==contactLine?contactBlock='<h3 class="iip-map-ol-popup-header">Contact: </h3><p>'+hostLine+"<br />"+contactLine+"</p>":""===hostLine&&""!==contactLine?contactBlock='<h3 class="iip-map-ol-popup-header">Contact: </h3><p>'+contactLine+"</p>":""!==hostLine&&""===contactLine?contactBlock='<h3 class="iip-map-ol-popup-header">Contact: </h3><p>'+hostLine+"</p>":contactBlock="";let n=new Date(e.event_date+" "+e.event_time),o=n.getDate(),a=n.toLocaleString("en-us",{month:"long"})+" "+o,r=n.getHours()+":"+("0"+n.getMinutes()).slice(-2),i='<div id="bodyContent-'+e.id+'" class="iip-map-ol-popup-body">'+topicLine+"<p>"+e.event_desc+'</p><h3 class="iip-map-ol-popup-header">When: </h3><p> On '+a+" at "+r+". <br />"+durationLine+'<h3 class="iip-map-ol-popup-header">Where: </h3><p>'+e.venue_name+"<br />"+e.venue_city+"<br />"+contactBlock+"</div>",l='<div class="iip-map-ol-popup" id="infowindow-'+e.id+'"><h1 id="firstHeading" class="iip-map-ol-popup-header">'+e.event_name+" - "+a+"</h1>"+i+"</div>";var c=new ol.Feature({content:l,geometry:new ol.geom.Point(ol.proj.transform(t,"EPSG:4326","EPSG:3857")),id:e.id,text:i,title:e.event_name,date:a});markerSource.addFeature(c)})}map.on("click",function(e){let t=new Popup;map.addOverlay(t);let n=e.coordinate,o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(o){let e=o.get("features"),l=e[0].N.content,c=e.length;if(1===c)t.show(n,l),i();else{let o=document.createElement("div");o.className="iip-map-ol-popup";for(var a=0;a<c;a++){let t=e[a].N.id,n='<div class="marker-accordion closed">'+('<h1 class="marker-event-title iip-map-ol-popup-header" id="title-marker-'+t+'">'+e[a].N.title+" - "+e[a].N.date+'<span class="arrow">â–²</span> </h1>')+('<div class="marker-text" id="text-marker-'+t+'">'+e[a].N.text+"</div>")+"</div>";o.insertAdjacentHTML("afterbegin",n)}t.show(n,o),i();let l=document.getElementsByClassName("marker-accordion"),s=document.getElementsByClassName("marker-event-title");for(a=0;a<s.length;a++)s[a].addEventListener("click",r,!1);function r(){let e=this.parentNode.className;for(var t=0;t<l.length;t++)l[t].className="marker-accordion closed";"marker-accordion closed"==e&&(this.parentNode.className="marker-accordion opened")}}}else t.hide();function i(){let e=map.getSize(),t=e[0]/2,o=e[1]/4;mapCenter.centerOn(n,map.getSize(),[t,o])}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ol/overlay")):"function"==typeof define&&define.amd?define(["ol/overlay"],t):e.Popup=t(e.ol.Overlay)}(this,function(e){"use strict";e="default"in e?e.default:e;var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(a){function r(e){t(this,r);var n=e||{};void 0===n.autoPan&&(n.autoPan=!0),void 0===n.autoPanAnimation&&(n.autoPanAnimation={duration:250});var a=document.createElement("div");n.element=a;var i=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,n));i.container=a,i.container.className="ol-popup",i.closer=document.createElement("a"),i.closer.className="ol-popup-closer",i.closer.href="#",i.container.appendChild(i.closer);var l=i;return i.closer.addEventListener("click",function(e){l.container.style.display="none",l.closer.blur(),e.preventDefault()},!1),i.content=document.createElement("div"),i.content.className="ol-popup-content",i.container.appendChild(i.content),r.enableTouchScroll_(i.content),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),n(r,[{key:"show",value:function(e,t){return t instanceof HTMLElement?(this.content.innerHTML="",this.content.appendChild(t)):this.content.innerHTML=t,this.container.style.display="block",this.content.scrollTop=0,this.setPosition(e),this}},{key:"hide",value:function(){return this.container.style.display="none",this}},{key:"isOpened",value:function(){return"block"==this.container.style.display}}],[{key:"isTouchDevice_",value:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}},{key:"enableTouchScroll_",value:function(e){if(r.isTouchDevice_()){var t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}}}]),r}();return window.ol&&window.ol.Overlay&&(window.ol.Overlay.Popup=a),a});